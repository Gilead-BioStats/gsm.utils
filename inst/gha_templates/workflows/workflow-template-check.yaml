# gsm.utils GHA version: 0.2.0
# Generated by: https://github.com/Gilead-BioStats/gsm.utils
# Description: Check if GitHub Actions workflows match gsm.utils templates

name: Workflow Template Compliance Check

on:
  push:
    branches: [main, release]
  pull_request:
    branches: [main, release]
    types: [opened, synchronize, reopened]

permissions: read-all

jobs:
  check-workflow-compliance:
    runs-on: ubuntu-latest
    name: Check Workflow Template Compliance

    steps:
      - name: Checkout current repository
        uses: actions/checkout@v4
        with:
          path: current-repo

      - name: Setup R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: 'release'

      - name: Install remotes
        run: Rscript -e "install.packages('remotes')"

      - name: Install gsm.utils from GitHub
        run: Rscript -e "remotes::install_github('Gilead-BioStats/gsm.utils')"

      - name: Check workflow compliance
        run: Rscript -e "gsm.utils::check_workflow_compliance('current-repo')"

      - name: Show fix instructions on failure
        if: failure()
        run: |
          echo "::error::Workflow template compliance check failed"
          echo "To fix workflow template issues:"
          echo "1. Install gsm.utils: remotes::install_github('Gilead-BioStats/gsm.utils')"
          echo "2. Update your package: gsm.utils::update_gsm_package()"
          echo "3. Commit the updated workflow files"
          echo ""
          echo "For more information, see: https://github.com/Gilead-BioStats/gsm.utils"